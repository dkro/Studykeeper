<h1 class="study__name">
    {{model.title}}
    {{#if model.closed}}
        <span class="label label-warning study__header__label">Abgeschlossen</span>
    {{/if}}
</h1>

<div class="study__dateRange">
    <span class="glyphicon glyphicon-calendar study__dateRange--delimiter"></span> {{model.fromDate}} - {{model.untilDate}}
</div>

{{#if statusMessage}}
    {{status-message message=statusMessage.message isSuccess=statusMessage.isSuccess}}
{{/if}}

{{#if model.news}}
    <div class="panel panel-default">
        <div class="panel-heading">News zur Studie</div>
        <div class="panel-body customizedPanel">
            <div class="list-group panelDisplay__list">
                {{#each n in model.news}}
                    <a target="_blank" {{bind-attr href="n.link"}} class="list-group-item dashboardNews__item">
                        <h3 class="list-group-item-heading dashboardNews__item__heading">{{n.title}} <small>{{n.date}}</small></h3>
                        <div class="list-group-item-text dashboardNews__item__body">
                            {{n.description}}
                        </div>
                    </a>
                {{/each}}
            </div>
        </div>
    </div>
{{/if}}

<div class="data__wrapper">
    <div class="data__row">
        <div class="data__cell--description">Studientyp: </div>
        <div class="data__cell--value">
            {{#each label in model.labels}}
                <span class="study__label">{{label.title}}</span>
            {{/each}}
        </div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Ausführung: </div>
        <div class="data__cell--value data--person">
            {{model.executor.firstname}}&nbsp;{{model.executor.lastname}}
            <a {{bind-attr href="mailToExecutor"}} target="_top">
                <span class="glyphicon glyphicon-envelope data--person__mail"></span>
            </a>
        </div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Betreuer: </div>
        <div class="data__cell--value data--person">
            {{model.tutor.firstname}}&nbsp;{{model.tutor.lastname}}
            <a {{bind-attr href="mailToTutor"}} target="_top">
                <span class="glyphicon glyphicon-envelope data--person__mail"></span>
            </a>
        </div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Ort: </div>
        <div class="data__cell--value">{{model.location}}</div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Entlohnung: </div>
        <div class="data__cell--value">
            <span class="data--payment">{{model.compensation}}€ Amazon-Gutschein</span> oder <span class="data--payment">{{model.mmi}} MMI-Punkte</span>
        </div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Beschreibung: </div>
        <div class="data__cell--value">
            <div class="data--description">
                {{model.description}}
            </div>
        </div>
    </div>
    {{#each field in fieldNameToValues}}
        <div class="data__row">
            <div class="data__cell--description">{{field.title}}: </div>
            <div class="data__cell--value">{{field.value}}</div>
        </div>
    {{/each}}
    <div class="data__row">
        <div class="data__cell--description">Link: </div>
        <div class="data__cell--value">
            <a target="_blank" {{bind-attr href="model.link"}}>Zur Studie</a>
        </div>
    </div>
    <div class="data__row">
        <div class="data__cell--description">Freie Plätze: </div>
        <div class="data__cell--value">{{freeSpace}} von {{model.space}}</div>
    </div>
</div>

{{#if canEdit}}
    <div class="table-responsive management--all__table">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Teilnehmer</th>
                    <th>Vorname</th>
                    <th>Nachname</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {{#if model.registeredUsers}}
                    {{#each user in model.registeredUsers}}
                        <tr class="management--all__row">
                            <td>{{user.username}}</td>
                            <td>{{user.firstname}}</td>
                            <td>{{user.lastname}}</td>
                            <td>
                                <a {{bind-attr href="user.mailTo"}} target="_top">
                                    <span class="glyphicon glyphicon-envelope data--person__mail"></span>
                                </a>
                            </td>
                        </tr>
                    {{/each}}
                {{else}}
                    <tr>
                        <td class="management--all__emptyFilter" colspan="4">- Keine angemeldeten Nutzer -</td>
                    </tr>
                {{/if}}
            </tbody>
        </table>
    </div>
{{/if}}

{{#if model.closed}}
    {{#if canEdit}}
        <div class="alert alert-warning" role="alert">
            <strong>Achtung!</strong> <br>
            Die Studie wurde bereits abgeschlossen und die Amazon-Gutscheine und MMI-Punkte wurden für alle Teilnehmer
            persistent gespeichert. <br>
            Wenn Sie die Studie verändern oder neu abschließen, werden diese alten Änderungen
            nicht überschrieben!
        </div>
    {{/if}}
{{/if}}

<div class="study__button__wrapper">
    {{#if model.closed}}
        {{#if canEdit}}
            <button class="btn btn-primary study__editRegisterButton" {{action 'primaryButtonClick'}}>Bearbeiten</button>
        {{/if}}
    {{else}}
        <button class="btn btn-primary study__editRegisterButton" {{action 'primaryButtonClick'}}>
            {{#if canEdit}}
                Bearbeiten
            {{else}}
                {{#if isRegistered}}
                    Von dieser Studie abmelden
                {{else}}
                    Zu dieser Studie anmelden
                {{/if}}
            {{/if}}
        </button>
    {{/if}}

    <button class="btn btn-default study__cancelButton" {{action 'cancelButtonClick'}}>Alle Studien</button>

    {{#if model.published}}
        <button class="btn btn-default study__publicButton" {{action 'publicButtonClick'}}>Öffentliche Version</button>
    {{else}}
        {{#if isTutor}}
            <button class="btn btn-primary study__publishButton" {{action 'publishButtonClick'}}>Studie veröffentlichen</button>
        {{/if}}
    {{/if}}
</div>